{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Check if this command interacts with Untether systemd services:\n\nCommand: {{tool_input.command}}\n\nRules:\n1. If it contains 'systemctl' with 'untether-dev' (e.g. restart/start/stop untether-dev): this is the DEV service, which is correct for testing local changes. Respond with:\nDEV SERVICE: Before restarting untether-dev, verify:\n1. Tests pass: `uv run pytest`\n2. Lint clean: `uv run ruff check src/`\n\n2. If it contains 'systemctl' with just 'untether' (NOT 'untether-dev') and 'restart' or 'start' (e.g. 'restart untether', 'start untether'): this is the PRODUCTION service. Respond with:\nBLOCKED: Do NOT restart production (untether.service). Production runs a frozen PyPI wheel â€” local code changes have no effect on it. Restarting production during development is always wrong.\n\nTo test local changes, use the dev service instead:\n  systemctl --user restart untether-dev\n\nProduction should only be restarted after `pipx upgrade untether` following a PyPI release.\n\n3. If it contains 'pipx upgrade untether' followed by 'systemctl' restart of production: this is the correct production upgrade path. Respond: PASS\n\n4. Otherwise respond: PASS"
          }
        ]
      },
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Check if this file edit touches an Untether runner:\n\nFile: {{tool_input.file_path}}\n\nIf the path matches src/untether/runners/*.py or src/untether/runner.py, respond with:\nRUNNER CONTEXT:\n- Maintain the 3-event contract: StartedEvent -> ActionEvent(s) -> CompletedEvent (exactly one, always last)\n- Use EventFactory for event creation (src/untether/events.py)\n- If editing claude.py: preserve PTY lifecycle (openpty/setraw/close) and session registries (_SESSION_STDIN, _REQUEST_TO_SESSION)\n- If editing translate(): update corresponding test fixtures and reference docs in docs/reference/runners/\n- Run: uv run pytest tests/test_*_runner.py tests/test_claude_control.py -x\n\nIf the path matches src/untether/schemas/*.py, respond with:\nSCHEMA CONTEXT:\n- msgspec schema changes affect JSONL parsing (fields silently ignored if absent)\n- Check runner translate() still handles the new/changed fields\n- Update reference docs (stream-json-cheatsheet.md) and test fixtures\n\nIf the path matches src/untether/telegram/*.py, respond with:\nTELEGRAM CONTEXT:\n- All writes go through TelegramOutbox (never call Bot API directly from handlers)\n- Callback data max 64 bytes (format: prefix:action:id)\n- Call answerCallbackQuery promptly to clear spinner\n- For approval buttons: use early answering (answer_early=True, early_answer_toast())\n- Ephemeral messages: register via register_ephemeral_message() for auto-cleanup\n\nOtherwise respond: PASS"
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Check if this edit bumped a version in pyproject.toml:\n\nFile: {{tool_input.file_path}}\n\nIf the file path ends with 'pyproject.toml' AND the edit changed a line containing 'version =', respond with:\nRELEASE CHECKLIST:\n1. Create GitHub issues for all bug fixes/changes in this release (label: bug/enhancement)\n2. Add CHANGELOG.md entry: `## vX.Y.Z (YYYY-MM-DD)` with issue links [#N](...)\n3. Run `uv lock` to sync the lockfile\n4. Verify: `uv run pytest && uv run ruff check src/`\n5. Semantic versioning: patch (bug fixes), minor (new features), major (breaking changes)\n\nOtherwise respond: PASS"
          }
        ]
      }
    ]
  }
}
